<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Posert Data Vis Final</title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="css/posert.css" id="theme">
		<link rel="stylesheet" href="css/paraiso-light.css">
		<link rel="stylesheet" href="css/presentation.css">
	</head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
			<h1>BMI 525 Final</h1>
			<p>Choropleth presentation of Google Takeout location data</p>
		</section>
		<section data-auto-animate>
			<h1>Who is this for?</h1>
		</section>
		<section data-auto-animate>
			<h1>Who is this for?</h1>
			<p>
				I envision this plot as being helpful for a general audience, maybe people who are aware
				that some level of privacy invasion is happening as a result of smart phones, but perhaps
				not aware of just how much data is constantly collected.
			</p>
		</section>
		<section data-auto-animate>
			<h2>Data</h2>
			<p>For this project, I used data from <a href="https://takeout.google.com">Google Takeout</a></p>
		</section>
		<section data-auto-animate>
			<h2>Data</h2>
			<p>For this project, I used data from <a href="https://takeout.google.com">Google Takeout</a></p>
			<ul>
				<li>Google collects data on you to sell ads</li>
			</ul>
		</section>
		<section data-auto-animate>
			<h2>Data</h2>
			<p>For this project, I used data from <a href="https://takeout.google.com">Google Takeout</a></p>
			<ul>
				<li>Google collects data on you to sell ads</li>
				<li>Google "kindly" provides this data to you</li>
			</ul>
		</section>
		<section data-auto-animate>
			<h2>Data</h2>
			<p>For this project, I used data from <a href="https://takeout.google.com">Google Takeout</a></p>
			<ul>
				<li>Google collects data on you to sell ads</li>
				<li>Google "kindly" provides this data to you</li>
				<li>Location data is one of many options we can pick</li>
			</ul>
		</section>
		<section>
			<h1>Plot schematic</h1>
			<p>
				I think a convincing enough plot could be made by making a choropleth showing which neighborhoods
				I spend the most time in.
			</p>
		</section>
		<section data-auto-animate="">
			<h2>Data structure</h2>
			<p>
				Google provides a truly massive JSON document of location data. The most interesting columns are
				latitude, longitude, timestamp, and activity
			</p>
			<div class="fit-two" id="container">
				<div>
					<pre><code data-trim class="language-r" data-line-numbers>
						library(tidyverse)
						library(ggplot2)
						library(jsonlite)

						location_json <- fromJSON('Location History.json')
						
						glimpse(location_json)
					</code></pre>
				</div>
				<div>
					<pre><code data-trim class="language-r">
						List of 1
						$ locations:'data.frame':	1983695 obs. of  14 variables:
						..$ timestampMs     : chr [1:1983695] "1301961469499" "1301963940890" "1301964189152" "1301964191127" ...
						..$ latitudeE7      : int [1:1983695] 336192880 336192880 336503700 336193410 336192890 336519440 336519440 336192890 336195780 336519440 ...
						..$ longitudeE7     : int [1:1983695] -1178402620 -1178402620 -1178256820 -1178401480 -1178402600 -1179043110 -1179043110 -1178402600 -1178398950 -1179043110 ...
						..$ accuracy        : int [1:1983695] 25 25 995 49 49 1867 1867 49 49 1867 ...
						..$ source          : chr [1:1983695] "network" "network" "cell" "wifi" ...
						..$ activity        :List of 1983695
						.. ..$ : NULL
						.. ..$ : NULL
						.. .. [list output truncated]
						..$ deviceTag       : int [1:1983695] NA NA NA NA NA NA NA NA NA NA ...
						..$ platform        : chr [1:1983695] NA NA NA NA ...
						..$ platformType    : chr [1:1983695] NA NA NA NA ...
						..$ locationMetadata:List of 1983695
						.. ..$ : NULL
						.. ..$ : NULL
						.. .. [list output truncated]
						..$ altitude        : int [1:1983695] NA NA NA NA NA NA NA NA NA NA ...
						..$ verticalAccuracy: int [1:1983695] NA NA NA NA NA NA NA NA NA NA ...
						..$ velocity        : int [1:1983695] NA NA NA NA NA NA NA NA NA NA ...
						..$ heading         : int [1:1983695] NA NA NA NA NA NA NA NA NA NA ...
					</code></pre>
				</div>
			</div>
		</section>
		<section>
			<h2>Skipping ahead for time</h2>
			<p>Full writeup can be found at <a href="http://blog.posertinlab.com/posts/2021-06-03-data-vis-final/">
				blog.posertinlab.com/posts/2021-06-03-data-vis-final/
			</a></p>
		</section>
		<section>
      <h2>Project and plot points</h2>
			<div class="fit-two" id="container">
				<div>
					<pre><code data-trim class="language-r" data-line-numbers="1-37|1-9|11-15|16-28|29-37">
            library(sf)
            library(sp)
            library(ggmap)
            library(maps)
            library(ggspatial)
            
            # Get neighborhood data
            nhoods <- st_read('./nhood_data')
            river <- st_read('./river_data')
            
            # Fix lat/lon, filter, and project
            portland_df <- loc_df %>% 
              mutate(lat = lat/1e7, lon = lon/1e7) %>%
              filter(lat > 45.47 & lat < 45.61 &
                      lon > -122.8 & lon < -122.5)

            portland_latlon <- portland_df %>% 
            select(lon, lat)
            
            
            ploc_project <- sf_project(
              st_crs(4326),
              st_crs(3857),
              portland_latlon
            )
            
            portland_df$lon = ploc_project[,1]
            portland_df$lat = ploc_project[,2]
            
            nhoods %>% 
              ggplot() +
              geom_sf(fill = '#F7F6C5') +
              geom_sf(data=river, fill="#3f90df", size=0.0) +
              geom_point(
                data = head(portland_df, n = 100000),
                aes(x = lon, y = lat)
              )

					</code></pre>
				</div>
        <img src="static/initial_geo.png" class="fragment bordered" alt="">
			</div>
		</section>
    <section>
      <h2>Make choropleth</h2>
      <div class="fit-two" id="container">
        <div>
          <pre><code data-trim class="language-r" data-line-numbers="1-42|1-13|15-22|24-42">
            # Find which points go in which polygon
            pnts <- select(portland_df, lat, lon)

            pnts_sf <- st_as_sf(
              pnts, coords = c('lon', 'lat'),
              crs = st_crs(nhoods)
            )
            
            pnts <- pnts_sf %>% mutate(
                intersection = st_intersects(geometry, nhoods)
              ) %>% 
              unnest(intersection) %>% 
              mutate(NAME = nhoods$NAME[intersection])

            # Count points
            counted <- pnts %>% 
            count(NAME)
          
            counted_tibble <- tibble(
              NAME = counted$NAME,
              n = counted$n
            )
            
            counted_nhoods <- left_join(nhoods, counted_tibble) %>% 
            mutate(adj_counts = n/Shape_Area * 1000)
          
            breaks = c(0, 2, 4, 6, 8, 10, 100)
            counted_nhoods$disc_counts <- cut(
              counted_nhoods$adj_counts,
              breaks = breaks,
              include.lowest = TRUE)
            
            counted_nhoods %>% 
              ggplot() +
              theme_void() +
              ggtitle("Google knows where you sleep") +
              geom_sf(aes(fill = disc_counts)) +
              geom_sf(data=river, fill="#3f90df", size=0.0) +
              scale_fill_manual(
                values = c('#ffffd4','#fed98e','#fe9929','#d95f0e','#993404'),
                name = 'Area-normalized location samples'
              )

          </code></pre>
        </div>
        <img src="static/final_chloropleth.png" class="fragment bordered" alt="">
      </div>
    </section>
    <section>
      <h2>Not satisfying</h2>
      <div class="fit-two" id="container">
        <div>
          <p>
            Highlighting which neighborhoods I've lived and worked in since
            college does not actually seem that invasive.
          </p>

          <p>
            The points were more clearly offensive. Perhaps an animation
            conveys this information better
          </p>
        </div>
        <img src="static/final_chloropleth.png" class="bordered" alt="">
      </div>
    </section>
    <section>
      <div class="fit-two" id="container">
        <div>
          <pre><code data-trim class="language-r" data-line-numbers="1-15|1-7|9-12|9-15">
          library(gganimate)
          plot <- portland_df %>% 
            ggplot() +
            geom_sf(data = nhoods, fill = '#F7F6C5') +
            geom_sf(data=river, fill="#3f90df", size=0.0) +
            geom_path(aes(x = lon, y = lat)) +
            theme_void()
          
          anim <- plot +
            transition_time(timestamp) +
            labs(title = "{frame_time}") +
            shadow_wake(wake_length = 0.01)
          
          anim_complete <- animate(anim, fps = 30, nframes = 120*30)
          anim_save('since_college.gif', anim_complete)

          </code></pre>
        </div>
        <img src="static/since_college.gif" class="bordered" alt="">
      </div>
    </section>
      </div>
    </div>


    <script src="dist/reveal.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				center: true,
				hash: true,
				controls: false,
				slideNumber: 'c/t',
				width: 1200,
				autoPlayMedia: true,
				plugins: [ RevealHighlight ]
			});
		</script>
  </body>
</html>